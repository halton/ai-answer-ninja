# AI Answer Ninja - ç›‘æ§ç³»ç»Ÿè¿ç»´æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—æä¾›AI Answer Ninjaç›‘æ§ç³»ç»Ÿçš„å®Œæ•´è¿ç»´æŒ‡å¯¼ï¼ŒåŒ…æ‹¬æ—¥å¸¸ç»´æŠ¤ã€æ•…éšœæ’æŸ¥ã€æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µã€‚

## ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æ—¥å¸¸è¿ç»´ä»»åŠ¡](#æ—¥å¸¸è¿ç»´ä»»åŠ¡)
3. [ç›‘æ§æŒ‡æ ‡è§£è¯»](#ç›‘æ§æŒ‡æ ‡è§£è¯»)
4. [å‘Šè­¦å¤„ç†æµç¨‹](#å‘Šè­¦å¤„ç†æµç¨‹)
5. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
6. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
7. [å¤‡ä»½ä¸æ¢å¤](#å¤‡ä»½ä¸æ¢å¤)
8. [å‡çº§ä¸ç»´æŠ¤](#å‡çº§ä¸ç»´æŠ¤)
9. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### ç›‘æ§ç»„ä»¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Answer Ninja ç›‘æ§ç³»ç»Ÿ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®æ”¶é›†å±‚                                                      â”‚
â”‚  â”œâ”€ Prometheus (æŒ‡æ ‡æ”¶é›†)                                        â”‚
â”‚  â”œâ”€ Node Exporter (ç³»ç»ŸæŒ‡æ ‡)                                    â”‚
â”‚  â”œâ”€ Application Metrics (ä¸šåŠ¡æŒ‡æ ‡)                              â”‚
â”‚  â””â”€ Custom Collectors (è‡ªå®šä¹‰æ”¶é›†å™¨)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å­˜å‚¨å±‚                                                      â”‚
â”‚  â”œâ”€ Prometheus TSDB (æ—¶åºæ•°æ®)                                  â”‚
â”‚  â”œâ”€ Elasticsearch (æ—¥å¿—æ•°æ®)                                    â”‚
â”‚  â””â”€ Redis (ç¼“å­˜å’Œä¸´æ—¶æ•°æ®)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å¤„ç†å±‚                                                      â”‚
â”‚  â”œâ”€ Monitoring Service (æ™ºèƒ½åˆ†æ)                               â”‚
â”‚  â”œâ”€ Alert Manager (å‘Šè­¦ç®¡ç†)                                    â”‚
â”‚  â”œâ”€ Anomaly Detection (å¼‚å¸¸æ£€æµ‹)                                â”‚
â”‚  â””â”€ Auto Remediation (è‡ªåŠ¨ä¿®å¤)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯è§†åŒ–å±‚                                                       â”‚
â”‚  â”œâ”€ Grafana (ç›‘æ§é¢æ¿)                                         â”‚
â”‚  â”œâ”€ Jaeger (é“¾è·¯è¿½è¸ª)                                          â”‚
â”‚  â”œâ”€ Kibana (æ—¥å¿—æŸ¥è¯¢)                                          â”‚
â”‚  â””â”€ Custom Dashboards (è‡ªå®šä¹‰é¢æ¿)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç›‘æ§æŒ‡æ ‡

#### ä¸šåŠ¡æŒ‡æ ‡ (Golden Signals)
- **æˆåŠŸç‡**: `ai_ninja_calls_successful / ai_ninja_calls_total * 100`
- **å“åº”æ—¶é—´**: `histogram_quantile(0.95, ai_response_latency_seconds_bucket)`
- **é”™è¯¯ç‡**: `rate(http_requests_total{status=~"5.."}[5m])`
- **ååé‡**: `rate(ai_ninja_calls_total[5m])`

#### ç³»ç»ŸæŒ‡æ ‡ (USE Method)
- **åˆ©ç”¨ç‡**: CPU, Memory, Disk, Networkä½¿ç”¨ç‡
- **é¥±å’Œåº¦**: é˜Ÿåˆ—é•¿åº¦, è¿æ¥æ•°, èµ„æºç­‰å¾…
- **é”™è¯¯**: ç³»ç»Ÿçº§é”™è¯¯, ç»„ä»¶å¤±è´¥

## æ—¥å¸¸è¿ç»´ä»»åŠ¡

### æ¯æ—¥æ£€æŸ¥æ¸…å•

#### ğŸŒ… æ™¨é—´æ£€æŸ¥ (9:00 AM)

```bash
#!/bin/bash
# æ—¥å¸¸å¥åº·æ£€æŸ¥è„šæœ¬

echo "=== AI Answer Ninja ç³»ç»Ÿå¥åº·æ£€æŸ¥ ==="
echo "æ£€æŸ¥æ—¶é—´: $(date)"

# 1. æ£€æŸ¥æ ¸å¿ƒæœåŠ¡çŠ¶æ€
echo "1. æ£€æŸ¥æ ¸å¿ƒæœåŠ¡çŠ¶æ€..."
kubectl get pods -n ai-ninja -o wide
kubectl get pods -n ai-ninja-monitoring -o wide

# 2. æ£€æŸ¥å…³é”®æŒ‡æ ‡
echo "2. æ£€æŸ¥å…³é”®ä¸šåŠ¡æŒ‡æ ‡..."
curl -s 'http://prometheus:9090/api/v1/query?query=rate(ai_ninja_calls_successful[5m])/rate(ai_ninja_calls_total[5m])*100' | jq '.data.result[0].value[1]' | xargs printf "é€šè¯æˆåŠŸç‡: %.2f%%\n"

curl -s 'http://prometheus:9090/api/v1/query?query=histogram_quantile(0.95,rate(ai_response_latency_seconds_bucket[5m]))' | jq '.data.result[0].value[1]' | xargs printf "P95å“åº”æ—¶é—´: %.3fs\n"

# 3. æ£€æŸ¥æ´»è·ƒå‘Šè­¦
echo "3. æ£€æŸ¥æ´»è·ƒå‘Šè­¦..."
curl -s 'http://alertmanager:9093/api/v1/alerts' | jq '.data[] | select(.status.state=="active") | {alertname: .labels.alertname, severity: .labels.severity, startsAt: .startsAt}'

# 4. æ£€æŸ¥èµ„æºä½¿ç”¨
echo "4. æ£€æŸ¥èµ„æºä½¿ç”¨..."
kubectl top nodes
kubectl top pods -n ai-ninja --sort-by=cpu
kubectl top pods -n ai-ninja --sort-by=memory

# 5. æ£€æŸ¥å­˜å‚¨ç©ºé—´
echo "5. æ£€æŸ¥å­˜å‚¨ç©ºé—´..."
df -h | grep -E "(prometheus|grafana|elasticsearch)"

echo "=== å¥åº·æ£€æŸ¥å®Œæˆ ==="
```

#### ğŸ“Š æŒ‡æ ‡ç›‘æ§

æ¯æ—¥éœ€è¦å…³æ³¨çš„å…³é”®æŒ‡æ ‡ï¼š

| æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | è­¦å‘Šé˜ˆå€¼ | ä¸¥é‡é˜ˆå€¼ | å¤„ç†å»ºè®® |
|------|----------|----------|----------|----------|
| é€šè¯æˆåŠŸç‡ | >95% | <95% | <90% | æ£€æŸ¥AIæœåŠ¡å’Œç½‘ç»œè¿æ¥ |
| P95å“åº”æ—¶é—´ | <1.5s | >1.5s | >3.0s | åˆ†ææ€§èƒ½ç“¶é¢ˆ |
| CPUä½¿ç”¨ç‡ | <70% | >80% | >90% | è€ƒè™‘æ‰©å®¹æˆ–ä¼˜åŒ– |
| å†…å­˜ä½¿ç”¨ç‡ | <80% | >85% | >95% | æ£€æŸ¥å†…å­˜æ³„æ¼ |
| ç£ç›˜ä½¿ç”¨ç‡ | <80% | >85% | >90% | æ¸…ç†æ—¥å¿—å’Œæ•°æ® |
| é”™è¯¯ç‡ | <1% | >2% | >5% | ç´§æ€¥æ•…éšœæ’æŸ¥ |

### æ¯å‘¨ç»´æŠ¤ä»»åŠ¡

#### ğŸ”§ å‘¨ç»´æŠ¤æ¸…å•

```bash
#!/bin/bash
# å‘¨ç»´æŠ¤ä»»åŠ¡è„šæœ¬

echo "=== AI Answer Ninja å‘¨ç»´æŠ¤ä»»åŠ¡ ==="

# 1. æ›´æ–°å‘Šè­¦è§„åˆ™å’Œé˜ˆå€¼
echo "1. æ£€æŸ¥å¹¶æ›´æ–°å‘Šè­¦è§„åˆ™..."
kubectl apply -f monitoring/alerting/rules/

# 2. æ¸…ç†è¿‡æœŸæ•°æ®
echo "2. æ¸…ç†è¿‡æœŸç›‘æ§æ•°æ®..."
# Elasticsearchç´¢å¼•æ¸…ç† (ä¿ç•™30å¤©)
curl -X DELETE "http://elasticsearch:9200/ai-ninja-logs-$(date -d '30 days ago' +%Y.%m.%d)"
curl -X DELETE "http://elasticsearch:9200/ai-ninja-errors-$(date -d '30 days ago' +%Y.%m.%d)"

# 3. å¤‡ä»½é‡è¦é…ç½®
echo "3. å¤‡ä»½Grafanaä»ªè¡¨æ¿..."
mkdir -p backups/$(date +%Y%m%d)
./scripts/backup-grafana-dashboards.sh backups/$(date +%Y%m%d)/

# 4. æ€§èƒ½åŸºçº¿æ›´æ–°
echo "4. æ›´æ–°æ€§èƒ½åŸºçº¿..."
curl -X POST "http://monitoring-service:3009/api/baselines/update"

# 5. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
echo "5. æ£€æŸ¥SSLè¯ä¹¦..."
openssl x509 -in ssl/monitoring.crt -noout -dates

# 6. å­˜å‚¨ä½¿ç”¨åˆ†æ
echo "6. å­˜å‚¨ä½¿ç”¨åˆ†æ..."
du -sh data/* | sort -hr

echo "=== å‘¨ç»´æŠ¤ä»»åŠ¡å®Œæˆ ==="
```

### æ¯æœˆæ£€æŸ¥ä»»åŠ¡

#### ğŸ“ˆ æœˆåº¦æŠ¥å‘Š

```bash
#!/bin/bash
# æœˆåº¦ç›‘æ§æŠ¥å‘Šç”Ÿæˆ

echo "=== ç”Ÿæˆæœˆåº¦ç›‘æ§æŠ¥å‘Š ==="

REPORT_DATE=$(date +%Y-%m)
REPORT_FILE="reports/monthly-report-${REPORT_DATE}.md"

mkdir -p reports

cat > "$REPORT_FILE" << EOF
# AI Answer Ninja ç›‘æ§æœˆæŠ¥ - ${REPORT_DATE}

## æœåŠ¡æ¦‚è§ˆ

### SLAè¾¾æˆæƒ…å†µ
- ç³»ç»Ÿå¯ç”¨æ€§: $(curl -s 'http://prometheus:9090/api/v1/query?query=avg_over_time(up{job="phone-gateway"}[30d])*100' | jq -r '.data.result[0].value[1]' | cut -c1-5)%
- é€šè¯æˆåŠŸç‡: $(curl -s 'http://prometheus:9090/api/v1/query?query=avg_over_time(rate(ai_ninja_calls_successful[5m])/rate(ai_ninja_calls_total[5m])[30d:])*100' | jq -r '.data.result[0].value[1]' | cut -c1-5)%
- å¹³å‡å“åº”æ—¶é—´: $(curl -s 'http://prometheus:9090/api/v1/query?query=avg_over_time(histogram_quantile(0.95,rate(ai_response_latency_seconds_bucket[5m]))[30d:])' | jq -r '.data.result[0].value[1]' | cut -c1-5)s

### ä¸šåŠ¡æŒ‡æ ‡
- æ€»é€šè¯æ¬¡æ•°: $(curl -s 'http://prometheus:9090/api/v1/query?query=increase(ai_ninja_calls_total[30d])' | jq -r '.data.result[0].value[1]')
- æ‹¦æˆªåƒåœ¾ç”µè¯: $(curl -s 'http://prometheus:9090/api/v1/query?query=increase(ai_ninja_spam_blocked_total[30d])' | jq -r '.data.result[0].value[1]')
- æ–°å¢ç”¨æˆ·: $(curl -s 'http://prometheus:9090/api/v1/query?query=increase(ai_ninja_new_users_total[30d])' | jq -r '.data.result[0].value[1]')

### å‘Šè­¦ç»Ÿè®¡
- æ€»å‘Šè­¦æ•°: $(curl -s 'http://prometheus:9090/api/v1/query?query=increase(prometheus_notifications_total[30d])' | jq -r '.data.result[0].value[1]')
- Criticalå‘Šè­¦: $(curl -s 'http://alertmanager:9093/api/v1/alerts' | jq '[.data[] | select(.labels.severity=="critical")] | length')
- å¹³å‡ä¿®å¤æ—¶é—´: [éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢]

### æ€§èƒ½è¶‹åŠ¿
[ç”Ÿæˆæ€§èƒ½è¶‹åŠ¿å›¾è¡¨]

### æ”¹è¿›å»ºè®®
[åŸºäºæ•°æ®ç”Ÿæˆä¼˜åŒ–å»ºè®®]

EOF

echo "æœˆåº¦æŠ¥å‘Šå·²ç”Ÿæˆ: $REPORT_FILE"
```

## ç›‘æ§æŒ‡æ ‡è§£è¯»

### ä¸šåŠ¡æŒ‡æ ‡æ·±åº¦è§£æ

#### é€šè¯æˆåŠŸç‡æŒ‡æ ‡

```promql
# å®æ—¶æˆåŠŸç‡
rate(ai_ninja_calls_successful[5m]) / rate(ai_ninja_calls_total[5m]) * 100

# æŒ‰æœåŠ¡åˆ†ç»„çš„æˆåŠŸç‡
sum(rate(ai_ninja_calls_successful[5m])) by (service) / 
sum(rate(ai_ninja_calls_total[5m])) by (service) * 100

# æˆåŠŸç‡è¶‹åŠ¿åˆ†æ
avg_over_time((rate(ai_ninja_calls_successful[5m]) / rate(ai_ninja_calls_total[5m]) * 100)[24h:5m])
```

**è§£è¯»æŒ‡å—ï¼š**
- `>98%`: ä¼˜ç§€ - ç³»ç»Ÿè¿è¡Œæ­£å¸¸
- `95-98%`: è‰¯å¥½ - å¯èƒ½å­˜åœ¨è½»å¾®é—®é¢˜
- `90-95%`: è­¦å‘Š - éœ€è¦è°ƒæŸ¥å’Œä¼˜åŒ–
- `<90%`: ä¸¥é‡ - ç´§æ€¥å¤„ç†

#### AIå“åº”å»¶è¿Ÿåˆ†æ

```promql
# å„ç™¾åˆ†ä½å“åº”æ—¶é—´
histogram_quantile(0.50, rate(ai_response_latency_seconds_bucket[5m])) # P50ä¸­ä½æ•°
histogram_quantile(0.95, rate(ai_response_latency_seconds_bucket[5m])) # P95
histogram_quantile(0.99, rate(ai_response_latency_seconds_bucket[5m])) # P99

# æŒ‰ç»„ä»¶åˆ†æå»¶è¿Ÿ
histogram_quantile(0.95, rate(ai_component_latency_seconds_bucket[5m])) by (component)

# å»¶è¿Ÿåˆ†å¸ƒç›´æ–¹å›¾
rate(ai_response_latency_seconds_bucket[5m])
```

**å»¶è¿Ÿè¯„çº§æ ‡å‡†ï¼š**
- **P95 < 1.0s**: ä¼˜ç§€æ€§èƒ½
- **P95 1.0-1.5s**: è‰¯å¥½æ€§èƒ½
- **P95 1.5-3.0s**: å¯æ¥å—æ€§èƒ½
- **P95 > 3.0s**: æ€§èƒ½é—®é¢˜

#### é”™è¯¯ç‡ç›‘æ§

```promql
# æ€»ä½“é”™è¯¯ç‡
sum(rate(http_requests_total{status=~"5.."}[5m])) / 
sum(rate(http_requests_total[5m])) * 100

# æŒ‰æœåŠ¡é”™è¯¯ç‡
sum(rate(http_requests_total{status=~"5.."}[5m])) by (service) / 
sum(rate(http_requests_total[5m])) by (service) * 100

# é”™è¯¯è¶‹åŠ¿
increase(http_requests_total{status=~"5.."}[1h])
```

### ç³»ç»ŸæŒ‡æ ‡ç›‘æ§

#### èµ„æºåˆ©ç”¨ç‡

```promql
# CPUä½¿ç”¨ç‡
100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# å†…å­˜ä½¿ç”¨ç‡
(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100

# ç£ç›˜ä½¿ç”¨ç‡
(1 - node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100

# ç½‘ç»œI/O
rate(node_network_receive_bytes_total[5m])
rate(node_network_transmit_bytes_total[5m])
```

#### åº”ç”¨æ€§èƒ½æŒ‡æ ‡

```promql
# JVMå†…å­˜ä½¿ç”¨ (å¦‚æœä½¿ç”¨JavaæœåŠ¡)
jvm_memory_used_bytes / jvm_memory_max_bytes * 100

# Node.jsäº‹ä»¶å¾ªç¯å»¶è¿Ÿ
nodejs_eventloop_lag_seconds

# æ•°æ®åº“è¿æ¥æ± 
pg_stat_database_numbackends
redis_connected_clients

# é˜Ÿåˆ—é•¿åº¦
ai_ninja_queue_length
```

## å‘Šè­¦å¤„ç†æµç¨‹

### å‘Šè­¦åˆ†çº§å’Œå“åº”æ—¶é—´

| ç­‰çº§ | å“åº”æ—¶é—´ | å¤„ç†äººå‘˜ | é€šçŸ¥æ–¹å¼ | å‡çº§ç­–ç•¥ |
|------|----------|----------|----------|----------|
| **Critical** | 5åˆ†é’Ÿ | å½“ç­SRE | Slack + çŸ­ä¿¡ + PagerDuty | 15åˆ†é’Ÿå‡çº§åˆ°ç»ç† |
| **Warning** | 30åˆ†é’Ÿ | å¼€å‘å›¢é˜Ÿ | Slack + Email | 2å°æ—¶å‡çº§ |
| **Info** | 24å°æ—¶ | ç›¸å…³å›¢é˜Ÿ | Email | ä¸å‡çº§ |

### å‘Šè­¦å¤„ç†æ ‡å‡†æµç¨‹

#### 1. å‘Šè­¦æ¥æ”¶å’Œç¡®è®¤

```bash
# å‘Šè­¦ç¡®è®¤æ¨¡æ¿
echo "æ”¶åˆ°å‘Šè­¦: $ALERT_NAME"
echo "ä¸¥é‡ç¨‹åº¦: $SEVERITY"
echo "æœåŠ¡: $SERVICE"
echo "å¼€å§‹æ—¶é—´: $START_TIME"

# ç¡®è®¤å‘Šè­¦
curl -X POST "http://alertmanager:9093/api/v1/alerts" \
  -H "Content-Type: application/json" \
  -d '{"status": "acknowledged", "comment": "SREå·²ç¡®è®¤å¹¶å¼€å§‹å¤„ç†"}'
```

#### 2. åˆæ­¥è¯Šæ–­

```bash
#!/bin/bash
# å¿«é€Ÿè¯Šæ–­è„šæœ¬

ALERT_SERVICE=$1
echo "=== å¿«é€Ÿè¯Šæ–­: $ALERT_SERVICE ==="

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "1. æœåŠ¡çŠ¶æ€æ£€æŸ¥..."
kubectl get pods -l app=$ALERT_SERVICE -o wide

# æ£€æŸ¥æœ€è¿‘æ—¥å¿—
echo "2. æœ€è¿‘é”™è¯¯æ—¥å¿—..."
kubectl logs -l app=$ALERT_SERVICE --tail=50 --since=10m | grep -i error

# æ£€æŸ¥èµ„æºä½¿ç”¨
echo "3. èµ„æºä½¿ç”¨æƒ…å†µ..."
kubectl top pods -l app=$ALERT_SERVICE

# æ£€æŸ¥ç›¸å…³æŒ‡æ ‡
echo "4. å…³é”®æŒ‡æ ‡..."
curl -s "http://prometheus:9090/api/v1/query?query=up{job=\"$ALERT_SERVICE\"}"
curl -s "http://prometheus:9090/api/v1/query?query=rate(http_requests_total{service=\"$ALERT_SERVICE\"}[5m])"

echo "=== è¯Šæ–­å®Œæˆ ==="
```

#### 3. é—®é¢˜ä¿®å¤

å¸¸è§é—®é¢˜çš„æ ‡å‡†ä¿®å¤æµç¨‹ï¼š

##### æœåŠ¡ä¸å¯ç”¨
```bash
# 1. é‡å¯Pod
kubectl rollout restart deployment/$SERVICE_NAME -n ai-ninja

# 2. æ£€æŸ¥é…ç½®
kubectl get configmap $SERVICE_NAME-config -o yaml

# 3. æ‰©å®¹æœåŠ¡
kubectl scale deployment $SERVICE_NAME --replicas=3 -n ai-ninja

# 4. éªŒè¯æ¢å¤
curl -f http://$SERVICE_NAME/health
```

##### é«˜å»¶è¿Ÿé—®é¢˜
```bash
# 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
kubectl exec -it $DB_POD -- psql -c "SELECT count(*) FROM pg_stat_activity;"

# 2. æ£€æŸ¥ç¼“å­˜çŠ¶æ€
kubectl exec -it $REDIS_POD -- redis-cli info stats

# 3. åˆ†ææ…¢æŸ¥è¯¢
kubectl logs $SERVICE_POD | grep "slow query"

# 4. ä¸´æ—¶æ‰©å®¹
kubectl patch hpa $SERVICE_NAME -p '{"spec":{"minReplicas":5}}'
```

##### å†…å­˜æ³„æ¼
```bash
# 1. å†…å­˜ä½¿ç”¨åˆ†æ
kubectl top pods --sort-by=memory

# 2. ç”Ÿæˆheap dump (for Node.js)
kubectl exec $POD_NAME -- kill -USR2 $PID

# 3. é‡å¯é«˜å†…å­˜ä½¿ç”¨çš„Pod
kubectl delete pod $HIGH_MEMORY_POD

# 4. ç›‘æ§å†…å­˜è¶‹åŠ¿
curl "http://prometheus:9090/api/v1/query_range?query=container_memory_usage_bytes{pod=\"$POD_NAME\"}&start=$(date -d '1 hour ago' +%s)&end=$(date +%s)&step=60"
```

#### 4. äº‹åå¤„ç†

```bash
# ç”Ÿæˆäº‹æ•…æŠ¥å‘Š
cat > "incident-report-$(date +%Y%m%d-%H%M).md" << EOF
# äº‹æ•…æŠ¥å‘Š - $(date)

## åŸºæœ¬ä¿¡æ¯
- äº‹æ•…ID: INC-$(date +%Y%m%d%H%M)
- å‘ç°æ—¶é—´: $DISCOVERY_TIME
- è§£å†³æ—¶é—´: $RESOLUTION_TIME
- å½±å“æ—¶é•¿: $DURATION
- ä¸¥é‡ç­‰çº§: $SEVERITY

## äº‹æ•…æè¿°
$DESCRIPTION

## æ ¹æœ¬åŸå› 
$ROOT_CAUSE

## è§£å†³æ–¹æ¡ˆ
$RESOLUTION

## é¢„é˜²æªæ–½
$PREVENTION_MEASURES

## ç»éªŒæ•™è®­
$LESSONS_LEARNED
EOF
```

### è‡ªåŠ¨åŒ–å“åº”é…ç½®

#### æœåŠ¡è‡ªæ„ˆé…ç½®

```yaml
# monitoring-serviceé…ç½®
autoRemediation:
  enabled: true
  rules:
    - name: restart-unhealthy-pods
      conditions:
        - metric: up{job=~"phone-gateway|realtime-processor"}
          operator: "=="
          value: 0
          duration: 2m
      actions:
        - type: kubectl
          command: "rollout restart deployment/{service} -n ai-ninja"
        - type: notify
          message: "è‡ªåŠ¨é‡å¯äº†ä¸å¥åº·çš„æœåŠ¡: {service}"
      cooldown: 10m

    - name: scale-on-high-load
      conditions:
        - metric: rate(http_requests_total[1m])
          operator: ">"
          value: 100
          duration: 5m
      actions:
        - type: kubectl
          command: "scale deployment/{service} --replicas=5 -n ai-ninja"
        - type: notify
          message: "ç”±äºé«˜è´Ÿè½½è‡ªåŠ¨æ‰©å®¹æœåŠ¡: {service}"
      cooldown: 15m
```

## æ•…éšœæ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜æ’æŸ¥æ‰‹å†Œ

#### é—®é¢˜ï¼šAIå“åº”å»¶è¿Ÿè¿‡é«˜

**ç—‡çŠ¶ï¼š**
- P95å“åº”æ—¶é—´ > 3ç§’
- ç”¨æˆ·æŠ•è¯‰å“åº”æ…¢
- é˜Ÿåˆ—ç§¯å‹

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **ç¡®è®¤é—®é¢˜èŒƒå›´**
```bash
# æ£€æŸ¥å„ç»„ä»¶å»¶è¿Ÿ
curl -s 'http://prometheus:9090/api/v1/query?query=histogram_quantile(0.95,rate(ai_component_latency_seconds_bucket[5m]))' | jq '.data.result[] | {component: .metric.component, latency: .value[1]}'
```

2. **åˆ†æç“¶é¢ˆç»„ä»¶**
```bash
# STTæœåŠ¡å»¶è¿Ÿ
curl -s 'http://prometheus:9090/api/v1/query?query=histogram_quantile(0.95,rate(ai_component_latency_seconds_bucket{component="stt"}[5m]))'

# AIç”Ÿæˆå»¶è¿Ÿ
curl -s 'http://prometheus:9090/api/v1/query?query=histogram_quantile(0.95,rate(ai_component_latency_seconds_bucket{component="ai_generation"}[5m]))'

# TTSæœåŠ¡å»¶è¿Ÿ
curl -s 'http://prometheus:9090/api/v1/query?query=histogram_quantile(0.95,rate(ai_component_latency_seconds_bucket{component="tts"}[5m]))'
```

3. **æ£€æŸ¥å¤–éƒ¨ä¾èµ–**
```bash
# AzureæœåŠ¡å¥åº·çŠ¶æ€
curl -s 'http://monitoring-service:3009/api/azure/health'

# æ•°æ®åº“æ€§èƒ½
kubectl exec -it postgres-pod -- psql -c "
SELECT query, calls, mean_exec_time, rows, 100.0 * shared_blks_hit / nullif(shared_blks_hit + shared_blks_read, 0) AS hit_percent
FROM pg_stat_statements 
ORDER BY mean_exec_time DESC 
LIMIT 10;"
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
1. **çŸ­æœŸä¿®å¤** - æ‰©å®¹ç›¸å…³æœåŠ¡
2. **ä¸­æœŸä¼˜åŒ–** - ä¼˜åŒ–æ…¢æŸ¥è¯¢å’Œç®—æ³•
3. **é•¿æœŸæ”¹è¿›** - æ¶æ„ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥

#### é—®é¢˜ï¼šå†…å­˜ä½¿ç”¨è¿‡é«˜

**æ’æŸ¥æµç¨‹ï¼š**

1. **è¯†åˆ«é«˜å†…å­˜ä½¿ç”¨çš„Pod**
```bash
kubectl top pods --sort-by=memory -A | head -20
```

2. **åˆ†æå†…å­˜ä½¿ç”¨æ¨¡å¼**
```bash
# Node.jså†…å­˜åˆ†æ
kubectl exec $POD_NAME -- node -e "console.log(process.memoryUsage())"

# æ£€æŸ¥å†…å­˜æ³„æ¼
curl "http://prometheus:9090/api/v1/query_range?query=container_memory_usage_bytes{pod=\"$POD_NAME\"}&start=$(date -d '24 hours ago' +%s)&end=$(date +%s)&step=300"
```

3. **ç”Ÿæˆå†…å­˜åˆ†ææŠ¥å‘Š**
```bash
# åˆ›å»ºå†…å­˜åˆ†æè„šæœ¬
./scripts/memory-analysis.sh $POD_NAME
```

#### é—®é¢˜ï¼šæ•°æ®åº“æ€§èƒ½ä¸‹é™

**è¯Šæ–­æŸ¥è¯¢ï¼š**

```sql
-- æ´»è·ƒè¿æ¥æ•°
SELECT count(*) as active_connections FROM pg_stat_activity WHERE state = 'active';

-- æ…¢æŸ¥è¯¢
SELECT query, calls, total_exec_time, mean_exec_time, rows 
FROM pg_stat_statements 
WHERE mean_exec_time > 1000 
ORDER BY mean_exec_time DESC 
LIMIT 10;

-- é”ç­‰å¾…
SELECT blocked_locks.pid AS blocked_pid,
       blocked_activity.usename AS blocked_user,
       blocking_locks.pid AS blocking_pid,
       blocking_activity.usename AS blocking_user,
       blocked_activity.query AS blocked_statement,
       blocking_activity.query AS current_statement_in_blocking_process
FROM pg_catalog.pg_locks blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks blocking_locks ON blocking_locks.locktype = blocked_locks.locktype
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.GRANTED;

-- è¡¨è†¨èƒ€æ£€æŸ¥
SELECT schemaname, tablename, attname, n_distinct, correlation 
FROM pg_stats 
WHERE schemaname = 'public' 
ORDER BY n_distinct DESC;
```

### æ€§èƒ½åŸºçº¿åç¦»åˆ†æ

å½“æ€§èƒ½æŒ‡æ ‡åç¦»åŸºçº¿æ—¶ï¼Œä½¿ç”¨ä»¥ä¸‹åˆ†ææ¡†æ¶ï¼š

#### 1. æ—¶é—´åºåˆ—åˆ†æ

```promql
# å¯¹æ¯”å½“å‰å€¼ä¸å†å²åŸºçº¿
(current_metric_value - avg_over_time(metric[7d] offset 7d)) / avg_over_time(metric[7d] offset 7d) * 100

# ä¾‹ï¼šå“åº”æ—¶é—´åŸºçº¿åç¦»
(histogram_quantile(0.95, rate(ai_response_latency_seconds_bucket[5m])) - 
 histogram_quantile(0.95, avg_over_time(rate(ai_response_latency_seconds_bucket[5m])[7d] offset 7d))) / 
 histogram_quantile(0.95, avg_over_time(rate(ai_response_latency_seconds_bucket[5m])[7d] offset 7d)) * 100
```

#### 2. å¼‚å¸¸æ£€æµ‹ç»“æœæŸ¥è¯¢

```bash
# è·å–å¼‚å¸¸æ£€æµ‹ç»“æœ
curl -s 'http://monitoring-service:3009/api/anomalies/recent' | jq '.anomalies[] | select(.score > 0.8)'

# æŸ¥çœ‹æ€§èƒ½åŸºçº¿æŠ¥å‘Š
curl -s 'http://monitoring-service:3009/api/baselines/report'
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç›‘æ§ç³»ç»Ÿè‡ªèº«ä¼˜åŒ–

#### Prometheusä¼˜åŒ–

```yaml
# prometheus.yml ä¼˜åŒ–é…ç½®
global:
  scrape_interval: 15s       # æ ¹æ®éœ€è¦è°ƒæ•´é‡‡é›†é—´éš”
  evaluation_interval: 15s
  external_labels:
    cluster: 'ai-ninja-production'

# å­˜å‚¨ä¼˜åŒ–
storage:
  tsdb:
    retention.time: 30d      # æ•°æ®ä¿ç•™æœŸ
    retention.size: 50GB     # å­˜å‚¨å¤§å°é™åˆ¶
    wal-compression: true    # å¯ç”¨WALå‹ç¼©
    
# æŸ¥è¯¢ä¼˜åŒ–
query:
  max-concurrency: 20       # å¹¶å‘æŸ¥è¯¢æ•°é™åˆ¶
  timeout: 2m               # æŸ¥è¯¢è¶…æ—¶æ—¶é—´
  lookback-delta: 5m        # å›æº¯çª—å£
```

#### Grafanaä¼˜åŒ–

```ini
# grafana.ini æ€§èƒ½ä¼˜åŒ–
[database]
max_open_conn = 300
max_idle_conn = 300
conn_max_lifetime = 14400

[dataproxy]
timeout = 30
keep_alive_seconds = 30

[caching]
enabled = true

[panels]
disable_sanitize_html = true

[feature_toggles]
enable = publicDashboards,panelsBar
```

#### ç›‘æ§æ•°æ®ä¼˜åŒ–ç­–ç•¥

1. **æ•°æ®é‡‡é›†ä¼˜åŒ–**
```yaml
# é«˜é¢‘é‡‡é›† (5-15ç§’)
high_frequency_metrics:
  - ai_response_latency
  - active_calls
  - error_rates

# ä¸­é¢‘é‡‡é›† (30-60ç§’)  
medium_frequency_metrics:
  - system_resources
  - business_metrics
  - queue_lengths

# ä½é¢‘é‡‡é›† (5åˆ†é’Ÿ+)
low_frequency_metrics:
  - daily_statistics
  - user_metrics
  - cost_metrics
```

2. **å­˜å‚¨åˆ†å±‚ç­–ç•¥**
```yaml
storage_tiers:
  hot_data:     # æœ€è¿‘7å¤©ï¼Œé«˜é¢‘è®¿é—®
    retention: 7d
    resolution: 15s
    storage: SSD
    
  warm_data:    # æœ€è¿‘30å¤©ï¼Œä¸­é¢‘è®¿é—®  
    retention: 30d
    resolution: 1m
    storage: HDD
    
  cold_data:    # å†å²æ•°æ®ï¼Œä½é¢‘è®¿é—®
    retention: 1y
    resolution: 5m
    storage: Object Storage
```

### å‘Šè­¦ä¼˜åŒ–å»ºè®®

#### æ™ºèƒ½å‘Šè­¦é…ç½®

```yaml
# é˜²æŠ–åŠ¨é…ç½®
anti_flapping:
  min_duration: 2m          # æœ€å°æŒç»­æ—¶é—´
  hysteresis: 10%           # è¿Ÿæ»ç™¾åˆ†æ¯”
  
# å‘Šè­¦åˆ†ç»„
grouping:
  by: ['service', 'severity', 'environment']
  wait: 30s                 # ç»„å†…ç­‰å¾…æ—¶é—´
  interval: 5m              # ç»„é—´é—´éš”

# æ™ºèƒ½æŠ‘åˆ¶
inhibition:
  - source_matchers:
      severity: critical
    target_matchers:
      severity: warning
    equal: ['service', 'instance']
```

#### å‘Šè­¦è´¨é‡æå‡

1. **å¯æ“ä½œæ€§æ£€æŸ¥æ¸…å•**
   - [ ] å‘Šè­¦ä¿¡æ¯åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡
   - [ ] æä¾›æ˜ç¡®çš„å¤„ç†å»ºè®®
   - [ ] åŒ…å«ç›¸å…³çš„ä»ªè¡¨æ¿é“¾æ¥
   - [ ] è®¾ç½®åˆç†çš„é˜ˆå€¼å’ŒæŒç»­æ—¶é—´

2. **å‘Šè­¦é™å™ªç­–ç•¥**
   - å®æ–½å‘Šè­¦ä¾èµ–å…³ç³»
   - ä½¿ç”¨ç»´æŠ¤çª—å£é™é»˜
   - é…ç½®ä¸šåŠ¡æ—¶é—´æ„ŸçŸ¥å‘Šè­¦
   - å®šæœŸå®¡æŸ¥å’Œä¼˜åŒ–é˜ˆå€¼

## å¤‡ä»½ä¸æ¢å¤

### å¤‡ä»½ç­–ç•¥

#### è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash
# ç›‘æ§ç³»ç»Ÿå¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/monitoring/$(date +%Y%m%d)"
mkdir -p "$BACKUP_DIR"

echo "=== å¼€å§‹ç›‘æ§ç³»ç»Ÿå¤‡ä»½ ==="

# 1. Grafanaä»ªè¡¨æ¿å¤‡ä»½
echo "å¤‡ä»½Grafanaä»ªè¡¨æ¿..."
curl -s -H "Authorization: Bearer $GRAFANA_API_KEY" \
  "http://grafana:3000/api/search?type=dash-db" | \
  jq -r '.[].uid' | \
  while read uid; do
    curl -s -H "Authorization: Bearer $GRAFANA_API_KEY" \
      "http://grafana:3000/api/dashboards/uid/$uid" | \
      jq '.dashboard' > "$BACKUP_DIR/dashboard-$uid.json"
  done

# 2. Prometheusé…ç½®å¤‡ä»½
echo "å¤‡ä»½Prometheusé…ç½®..."
kubectl get configmap prometheus-config -o yaml > "$BACKUP_DIR/prometheus-config.yaml"
cp -r alerting/rules "$BACKUP_DIR/alert-rules"

# 3. å‘Šè­¦é…ç½®å¤‡ä»½
echo "å¤‡ä»½å‘Šè­¦é…ç½®..."
kubectl get configmap alertmanager-config -o yaml > "$BACKUP_DIR/alertmanager-config.yaml"

# 4. ç›‘æ§æœåŠ¡é…ç½®å¤‡ä»½
echo "å¤‡ä»½ç›‘æ§æœåŠ¡é…ç½®..."
kubectl get deployment monitoring-service -o yaml > "$BACKUP_DIR/monitoring-service-config.yaml"

# 5. æ•°æ®åº“Schemaå¤‡ä»½
echo "å¤‡ä»½æ•°æ®åº“Schema..."
kubectl exec postgres-pod -- pg_dump -s ai_ninja > "$BACKUP_DIR/monitoring-schema.sql"

# 6. é‡è¦æ•°æ®å¤‡ä»½
echo "å¤‡ä»½å…³é”®æ•°æ®..."
kubectl exec postgres-pod -- pg_dump -t performance_baselines -t alert_rules ai_ninja > "$BACKUP_DIR/monitoring-data.sql"

# 7. å‹ç¼©å¤‡ä»½
echo "å‹ç¼©å¤‡ä»½æ–‡ä»¶..."
tar -czf "${BACKUP_DIR}.tar.gz" -C "$(dirname $BACKUP_DIR)" "$(basename $BACKUP_DIR)"
rm -rf "$BACKUP_DIR"

# 8. ä¸Šä¼ åˆ°äº‘å­˜å‚¨ (å¯é€‰)
if [[ -n "$AWS_S3_BUCKET" ]]; then
  aws s3 cp "${BACKUP_DIR}.tar.gz" "s3://$AWS_S3_BUCKET/monitoring-backups/"
fi

echo "=== å¤‡ä»½å®Œæˆ: ${BACKUP_DIR}.tar.gz ==="
```

### æ¢å¤æµç¨‹

#### ç¾éš¾æ¢å¤æ­¥éª¤

```bash
#!/bin/bash
# ç›‘æ§ç³»ç»Ÿæ¢å¤è„šæœ¬

BACKUP_FILE=$1
if [[ ! -f "$BACKUP_FILE" ]]; then
  echo "é”™è¯¯: å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨: $BACKUP_FILE"
  exit 1
fi

echo "=== å¼€å§‹ç›‘æ§ç³»ç»Ÿæ¢å¤ ==="

# 1. è§£å‹å¤‡ä»½
RESTORE_DIR="/tmp/restore-$(date +%s)"
mkdir -p "$RESTORE_DIR"
tar -xzf "$BACKUP_FILE" -C "$RESTORE_DIR"

# 2. æ¢å¤Prometheusé…ç½®
echo "æ¢å¤Prometheusé…ç½®..."
kubectl apply -f "$RESTORE_DIR/prometheus-config.yaml"
kubectl rollout restart deployment/prometheus -n ai-ninja-monitoring

# 3. æ¢å¤å‘Šè­¦é…ç½®
echo "æ¢å¤å‘Šè­¦é…ç½®..."
kubectl apply -f "$RESTORE_DIR/alertmanager-config.yaml"
kubectl rollout restart deployment/alertmanager -n ai-ninja-monitoring

# 4. æ¢å¤Grafanaä»ªè¡¨æ¿
echo "æ¢å¤Grafanaä»ªè¡¨æ¿..."
for dashboard in "$RESTORE_DIR"/dashboard-*.json; do
  if [[ -f "$dashboard" ]]; then
    curl -X POST \
      -H "Content-Type: application/json" \
      -H "Authorization: Bearer $GRAFANA_API_KEY" \
      -d @"$dashboard" \
      "http://grafana:3000/api/dashboards/db"
  fi
done

# 5. æ¢å¤æ•°æ®åº“æ•°æ®
echo "æ¢å¤æ•°æ®åº“æ•°æ®..."
kubectl exec -i postgres-pod -- psql ai_ninja < "$RESTORE_DIR/monitoring-data.sql"

# 6. é‡å¯ç›‘æ§æœåŠ¡
echo "é‡å¯ç›‘æ§æœåŠ¡..."
kubectl rollout restart deployment/monitoring-service -n ai-ninja-monitoring

# 7. éªŒè¯æ¢å¤
echo "éªŒè¯ç³»ç»Ÿæ¢å¤..."
sleep 30
kubectl get pods -n ai-ninja-monitoring
curl -f http://grafana:3000/api/health
curl -f http://prometheus:9090/-/healthy

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf "$RESTORE_DIR"

echo "=== æ¢å¤å®Œæˆ ==="
```

## å‡çº§ä¸ç»´æŠ¤

### æ»šåŠ¨å‡çº§æµç¨‹

#### Prometheuså‡çº§

```bash
#!/bin/bash
# Prometheusæ»šåŠ¨å‡çº§

NEW_VERSION="v2.46.0"
echo "å‡çº§Prometheusåˆ°ç‰ˆæœ¬: $NEW_VERSION"

# 1. å¤‡ä»½å½“å‰é…ç½®
kubectl get configmap prometheus-config -o yaml > prometheus-config-backup.yaml

# 2. æ›´æ–°é•œåƒç‰ˆæœ¬
kubectl set image deployment/prometheus prometheus=prom/prometheus:$NEW_VERSION -n ai-ninja-monitoring

# 3. ç›‘æ§å‡çº§è¿›åº¦
kubectl rollout status deployment/prometheus -n ai-ninja-monitoring

# 4. éªŒè¯å‡çº§
sleep 30
kubectl exec deployment/prometheus -- prometheus --version
curl -f http://prometheus:9090/-/healthy

# 5. å¦‚æœå‡çº§å¤±è´¥ï¼Œå›æ»š
if [[ $? -ne 0 ]]; then
  echo "å‡çº§å¤±è´¥ï¼Œæ‰§è¡Œå›æ»š..."
  kubectl rollout undo deployment/prometheus -n ai-ninja-monitoring
  exit 1
fi

echo "Prometheuså‡çº§æˆåŠŸ"
```

#### ç›‘æ§æœåŠ¡å‡çº§

```bash
#!/bin/bash
# ç›‘æ§æœåŠ¡å‡çº§è„šæœ¬

NEW_IMAGE="ai-ninja/monitoring-service:v2.1.0"

echo "=== å‡çº§ç›‘æ§æœåŠ¡ ==="

# 1. æ„å»ºæ–°é•œåƒ
docker build -t "$NEW_IMAGE" monitoring-service/

# 2. æ¨é€åˆ°é•œåƒä»“åº“
docker push "$NEW_IMAGE"

# 3. æ›´æ–°deployment
kubectl set image deployment/monitoring-service monitoring-service="$NEW_IMAGE" -n ai-ninja-monitoring

# 4. ç›‘æ§å‡çº§çŠ¶æ€
kubectl rollout status deployment/monitoring-service -n ai-ninja-monitoring --timeout=300s

# 5. å¥åº·æ£€æŸ¥
sleep 30
for i in {1..10}; do
  if curl -f http://monitoring-service:3009/health; then
    echo "å¥åº·æ£€æŸ¥é€šè¿‡"
    break
  fi
  if [[ $i -eq 10 ]]; then
    echo "å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œæ‰§è¡Œå›æ»š"
    kubectl rollout undo deployment/monitoring-service -n ai-ninja-monitoring
    exit 1
  fi
  sleep 10
done

echo "=== å‡çº§å®Œæˆ ==="
```

### ç»´æŠ¤çª—å£è§„åˆ’

#### å®šæœŸç»´æŠ¤æ—¶é—´è¡¨

```yaml
maintenance_schedule:
  weekly:
    day: Sunday
    time: "02:00-04:00 UTC"
    tasks:
      - update_alert_thresholds
      - cleanup_old_data
      - backup_configurations
      
  monthly:
    day: "First Sunday"
    time: "01:00-05:00 UTC"
    tasks:
      - system_updates
      - performance_optimization
      - security_patches
      
  quarterly:
    tasks:
      - major_version_upgrades
      - architecture_reviews
      - disaster_recovery_tests
```

## æœ€ä½³å®è·µ

### ç›‘æ§åŸåˆ™

#### 1. é»„é‡‘ä¿¡å·ä¼˜å…ˆ
ä¸“æ³¨äºå››ä¸ªå…³é”®ä¿¡å·ï¼š
- **å»¶è¿Ÿ** (Latency): ç”¨æˆ·è¯·æ±‚å¤„ç†æ—¶é—´
- **æµé‡** (Traffic): ç³»ç»Ÿå¤„ç†çš„è¯·æ±‚é‡
- **é”™è¯¯** (Errors): è¯·æ±‚å¤±è´¥çš„æ¯”ä¾‹  
- **é¥±å’Œåº¦** (Saturation): ç³»ç»Ÿèµ„æºä½¿ç”¨ç¨‹åº¦

#### 2. USEæ–¹æ³•è®º
- **åˆ©ç”¨ç‡** (Utilization): èµ„æºç¹å¿™ç¨‹åº¦
- **é¥±å’Œåº¦** (Saturation): æ’é˜Ÿç­‰å¾…ç¨‹åº¦
- **é”™è¯¯** (Errors): é”™è¯¯äº‹ä»¶æ•°é‡

#### 3. REDæ–¹æ³•è®º  
- **è¯·æ±‚é€Ÿç‡** (Rate): æ¯ç§’è¯·æ±‚æ•°
- **é”™è¯¯ç‡** (Errors): é”™è¯¯è¯·æ±‚æ¯”ä¾‹
- **æŒç»­æ—¶é—´** (Duration): è¯·æ±‚å¤„ç†æ—¶é—´åˆ†å¸ƒ

### å‘Šè­¦è®¾è®¡åŸåˆ™

#### SMARTå‘Šè­¦
- **S**pecific: å…·ä½“æ˜ç¡®çš„é—®é¢˜æè¿°
- **M**easurable: å¯é‡åŒ–çš„æŒ‡æ ‡é˜ˆå€¼  
- **A**ctionable: æä¾›æ˜ç¡®çš„å¤„ç†æ­¥éª¤
- **R**elevant: ä¸ä¸šåŠ¡å½±å“ç›¸å…³
- **T**ime-bound: è®¾ç½®åˆç†çš„æ—¶é—´çª—å£

#### å‘Šè­¦ç–²åŠ³é¢„é˜²
```yaml
alert_fatigue_prevention:
  # 1. å‘Šè­¦åˆ†å±‚
  severity_levels:
    - critical: "ç«‹å³å“åº” - å½±å“ç”¨æˆ·"
    - warning: "è®¡åˆ’å¤„ç† - æ½œåœ¨é—®é¢˜"
    - info: "ä¿¡æ¯è®°å½• - çŠ¶æ€å˜åŒ–"
  
  # 2. æ™ºèƒ½åˆ†ç»„
  grouping_strategy:
    by: ['service', 'environment', 'severity']
    interval: 5m
    
  # 3. è‡ªåŠ¨æŠ‘åˆ¶
  inhibition_rules:
    - source: "service_down"
      target: "high_latency" 
      reason: "æœåŠ¡å®•æœºæ—¶æŠ‘åˆ¶å»¶è¿Ÿå‘Šè­¦"
```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

#### æŸ¥è¯¢ä¼˜åŒ–

```promql
# å¥½çš„åšæ³•ï¼šä½¿ç”¨rate()è®¡ç®—é€Ÿç‡
rate(http_requests_total[5m])

# é¿å…ï¼šä½¿ç”¨increase()é™¤ä»¥æ—¶é—´
increase(http_requests_total[5m]) / (5 * 60)

# å¥½çš„åšæ³•ï¼šé™åˆ¶æ—¶é—´èŒƒå›´
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))

# é¿å…ï¼šé•¿æ—¶é—´èŒƒå›´æŸ¥è¯¢
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[1d]))

# å¥½çš„åšæ³•ï¼šä½¿ç”¨byå­å¥èšåˆ
sum by (service) (rate(http_requests_total[5m]))

# é¿å…ï¼šä¸å¿…è¦çš„é«˜åŸºæ•°èšåˆ
sum(rate(http_requests_total[5m])) by (method, path, status)
```

#### å­˜å‚¨ä¼˜åŒ–

```yaml
# ä¿ç•™ç­–ç•¥ä¼˜åŒ–
retention_policies:
  raw_metrics:
    retention: 15d
    resolution: 15s
    
  downsampled_5m:
    retention: 90d  
    resolution: 5m
    
  downsampled_1h:
    retention: 1y
    resolution: 1h

# å‹ç¼©è®¾ç½®
compression:
  enabled: true
  algorithm: snappy
  
# åˆ†åŒºç­–ç•¥  
partitioning:
  strategy: time_based
  interval: 1d
```

### å®‰å…¨æœ€ä½³å®è·µ

#### è®¿é—®æ§åˆ¶

```yaml
security_config:
  # 1. åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
  rbac:
    admin:
      - read:all
      - write:all
      - admin:all
    sre:
      - read:all
      - write:alerts
      - admin:alerts
    developer:
      - read:own_service
      - write:none
    viewer:
      - read:dashboards
      
  # 2. ç½‘ç»œè®¿é—®é™åˆ¶
  network_policies:
    - allow_from: ["ai-ninja", "ai-ninja-monitoring"]
    - deny_from: ["default", "public"]
    
  # 3. æ•°æ®è„±æ•
  data_anonymization:
    - mask_user_data: true
    - hash_phone_numbers: true
    - encrypt_pii: true
```

#### APIå®‰å…¨

```yaml
api_security:
  authentication:
    method: jwt
    expiry: 1h
    
  rate_limiting:
    per_user: 1000/hour
    per_ip: 100/minute
    
  input_validation:
    enabled: true
    schema_validation: true
    
  audit_logging:
    enabled: true
    include_request_body: false
    retention: 90d
```

### æ–‡æ¡£ç»´æŠ¤

#### è¿ç»´æ–‡æ¡£æ›´æ–°æµç¨‹

1. **æ¯æœˆå®¡æŸ¥** - æ£€æŸ¥æ–‡æ¡£å‡†ç¡®æ€§
2. **ç‰ˆæœ¬æ§åˆ¶** - ä½¿ç”¨Gitç®¡ç†æ–‡æ¡£ç‰ˆæœ¬
3. **åä½œæ›´æ–°** - å›¢é˜Ÿæˆå‘˜å…±åŒç»´æŠ¤
4. **è‡ªåŠ¨åŒ–æ£€æŸ¥** - è‡ªåŠ¨éªŒè¯é…ç½®ç¤ºä¾‹

#### çŸ¥è¯†åº“å»ºè®¾

```markdown
# çŸ¥è¯†åº“ç»“æ„
knowledge_base/
â”œâ”€â”€ runbooks/              # åº”æ€¥å¤„ç†æ‰‹å†Œ
â”œâ”€â”€ troubleshooting/       # æ•…éšœæ’æŸ¥æŒ‡å—  
â”œâ”€â”€ architecture/          # æ¶æ„æ–‡æ¡£
â”œâ”€â”€ configuration/         # é…ç½®å‚è€ƒ
â”œâ”€â”€ best-practices/        # æœ€ä½³å®è·µ
â””â”€â”€ tutorials/            # æ•™ç¨‹æŒ‡å—
```

---

## æ€»ç»“

æœ¬è¿ç»´æŒ‡å—æ¶µç›–äº†AI Answer Ninjaç›‘æ§ç³»ç»Ÿçš„å®Œæ•´è¿ç»´æµç¨‹ï¼Œä»æ—¥å¸¸ç›‘æ§åˆ°åº”æ€¥å“åº”ï¼Œä»æ€§èƒ½ä¼˜åŒ–åˆ°å®‰å…¨ä¿æŠ¤ã€‚é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µå’Œæ ‡å‡†æµç¨‹ï¼Œå¯ä»¥ç¡®ä¿ç›‘æ§ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œæœ‰æ•ˆæ€§ã€‚

å…³é”®æˆåŠŸå› ç´ ï¼š
- ğŸ¯ ä¸“æ³¨äºä¸šåŠ¡å…³é”®æŒ‡æ ‡
- âš¡ å¿«é€Ÿå“åº”å’Œè‡ªåŠ¨åŒ–
- ğŸ“Š æ•°æ®é©±åŠ¨çš„å†³ç­–
- ğŸ”„ æŒç»­æ”¹è¿›å’Œä¼˜åŒ–
- ğŸ‘¥ å›¢é˜Ÿåä½œå’ŒçŸ¥è¯†å…±äº«

è®°ä½ï¼šç›‘æ§ä¸æ˜¯ç›®çš„ï¼Œè€Œæ˜¯ä¿éšœä¸šåŠ¡ç¨³å®šè¿è¡Œçš„æ‰‹æ®µã€‚å§‹ç»ˆä»¥ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡ä»·å€¼ä¸ºæ ¸å¿ƒï¼Œæ„å»ºé«˜æ•ˆå¯é çš„ç›‘æ§ä½“ç³»ã€‚